# [🪄브라우저 렌더링](https://velog.io/@kyw0716/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EB%A0%8C%EB%8D%94%EB%A7%81)

## ❗ 브라우저의 주요 기능

사용자가 선택한 자원을 서버에 요청하고 브라우저에 표시하는 것

자원의 형태: 보통 HTML 문서지만 PDF, 이미지 등 다른 형태도 가능

자원의 주소는 URI(Uniform Resource Identifier)에 의해 정해짐

▶️ URI란? [참고 주소](https://en.wikipedia.org/wiki/Uniform_Resource_Identifier)

브라우저는 HTML, CSS 명세에 따라 HTML 파일을 해석해서 표시함.

<br>

## 🌐 브라우저의 기본 구조

1. 사용자 인터페이스
2. 브라우저 엔진
3. 렌더링 엔진
4. 통신
5. UI 백엔드
6. 자바스크립트 해석기
7. 자료 저장소

참고로 크롬은 대부분 브라우저와 달리 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지하고, 각 탭은 독립된 프로세스로 처리된다.

<br>

## ⚙️ 렌더링 엔진

### 역할

요청 받은 내용을 브라우저 화면에 표시하는 일

<br>

### 종류

가장 많이 쓰이는 브라우저의 렌더링 엔진은 다음과 같다.

- Gecko(파이어폭스)
- Webkit(사파리, 크롬)

<br>

### 동작 과정

1. HTML 파싱 + DOM 트리 구축

- HTML

  ```html
  <html>
    <body>
      <p>Hello World</p>
      <div><img src="example.png" /></div>
    </body>
  </html>
  ```

  위 마크업은 아래의 DOM 트리로 변환할 수 있다.

  ![](https://velog.velcdn.com/images/kyw0716/post/cc7ed63c-466d-4402-890a-15a406535029/image.png)

  (출처: [NaverD2](https://d2.naver.com/helloworld/59361))

  브라우저의 렌더링 첫 단계는 HTML을 위와 같이 DOM 트리로 변환하는 과정이다. 이때 만약 유효하지 않은 HTML 구문을 파싱하게 되면 브라우저가 모든 오류 구문을 교정하는 과정을 거치게 된다.

<br>

- CSS
  CSS 파일은 CSS 규칙을 포함한 스타일 시트 객체로 파싱된다. CSS 규칙 객체는 선택자, 선언 객체를 포함한다.

![](https://velog.velcdn.com/images/kyw0716/post/9c4f76df-6259-4f0a-ab3d-eb65ce903b5f/image.png)

(출처: [NaverD2](https://d2.naver.com/helloworld/59361))

2. 렌더 트리 구축

DOM트리가 구축되는 동안 브라우저는 렌더 트리를 구축한다. 이러한 렌더 트리의 구성 요소를 파이어폭스 에서는 프레임(frames), 웹킷에서는 렌더러(renderer)라고 부른다. 각 렌더러는 너비, 높이, 위치와 같은 기하학적 정보를 포함한다.

렌더러 기본 객체 구성

```cpp
class RenderObject { virtual
  void layout(); virtual
  void paint(PaintInfo); virtual
  void rect repaintRect();
  Node * node; //the DOM node
  RenderStyle * style; // the computed style
  RenderLayer * containgLayer; //the containing z-index layer
}
```

3. 렌더 트리 배치
   렌더러가 생성되어 처음 트리에 추가될 때 크기와 위치 정보를 갖고 있지 않는데 이런 값을 계산해주는 것을 배치 또는 리플로우라고 부른다. 배치는 크기 변경 또는 렌더러 위치 변화에 의해 실행되는 경우 렌더러의 크기를 다시 계산하지 않고 캐시에서 불러오는 방식으로 최적화 되어 있다.

배치의 과정은 다음과 같다.

> 부모 렌더러 너비 결정 -> 자식 검토 (자식 렌더러 배치, 자식 높이 계산) -> 자식의 누적 높이, 여백, 패딩등을 통해 부모 높이 결정

4. 렌더 트리 그리기
   그리기 단계에서는 화면에 내용을 표시하기 위한 렌더 트리의 탐색이 이루어지고, 렌더러의 `paint`메서드가 호출된다.

<br>

웹킷 동작 과정 (출처: [NaverD2](https://d2.naver.com/helloworld/59361))

![](https://velog.velcdn.com/images/kyw0716/post/0d640f7c-8a45-440f-9d55-151898e27e7b/image.png)

게코 동작 과정 (출처: [NaverD2](https://d2.naver.com/helloworld/59361))

![](https://velog.velcdn.com/images/kyw0716/post/b7444500-61ae-4e15-8a53-dd9c7d03aaf4/image.png)

<br>

## 📌 참고

> - [NaverD2](https://d2.naver.com/helloworld/59361)
>
> - 모던 자바스크립트 Deep Dive

<br>

## 🎁 추가 학습 주제

- 문서 파싱
  - 파싱 트리, 문법 트리, 컴파일 과정
  - 파서 종류
    - 파싱 알고리즘
    - [HTML 파싱 알고리즘 참고](https://html.spec.whatwg.org/multipage/parsing.html)
    - 토큰화 알고리즘
- 브라우저의 오류 처리 (유효하지 않은 HTML)
- 렌더링 엔진별 동작 과정
